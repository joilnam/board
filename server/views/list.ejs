<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
  <link rel="stylesheet" href="./style/style.scss">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
<%- include('nav.html')  -%>
<div class="wrapper">
  <h3>CINETOK</h3>
  <table class="table table-border">
    <thead>
    <tr>
      <th scope="col">no.</th>
      <th scope="col">Title</th>
      <th scope="col">Writer</th>
      <th scope="col">삭제</th>
      <th scope="col">수정</th>
    </tr>
    </thead>
    <tbody>
    <% for (var i = 0; i < cinetoks.length; i ++) { %>
      <tr>
        <td><%= cinetoks[i]._id   %></td>
        <td><a href="detail/<%= cinetoks[i]._id %>.ejs"><%= cinetoks[i].title %></a></td>
        <td><%= cinetoks[i].writer %></td>
        <td><button class="delete" data-id="<%=cinetoks[i]._id%>>" type="submit">삭제</button></td>
        <td><button class="edit" data-id="<%=cinetoks[i]._id%>>" type="submit">수정</button></td>
      </tr>
    <% } %>
    </tbody>
  </table>
</div>
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script>
  $('.delete').click(function(e){
    let rowNum=e.target.dataset.id;
    $.ajax({
      method:"DELETE",
      url:'/delete',
      data:{_id:rowNum},
    }).done(function(result){
        location.reload();
    }).fail(function(){
      console.log('실패!')
    });
  })
  $('.edit').click(function(e){
    let rowNum=e.target.dataset.id;
    $.ajax({
      method:"EDIT",
      url:'/edit:<%= cinetoks._id%>',
      data:{_id:rowNum},
    }).done(function(result){
      location.reload();
    }).fail(function(){
      console.log('실패!')
    });
  })
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
</body>
</html>